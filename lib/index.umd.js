(function(l,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(l=typeof globalThis<"u"?globalThis:l||self,t(l.dndlist={},l.Vue))})(this,function(l,t){"use strict";var $=Object.defineProperty;var M=(l,t,c)=>t in l?$(l,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[t]=c;var a=(l,t,c)=>(M(l,typeof t!="symbol"?t+"":t,c),c);const c={id:"p"},C=["id"],T={name:"DNDList"},k=t.defineComponent({...T,props:{wrapClass:{},itemClass:{},direction:{},itemId:{},list:{}},emits:["change"],setup(h,{expose:d,emit:f}){const n=h,i=t.ref([...n.list]);let y=t.ref(0);const u={from:0,to:0},D=t.ref(i.value[0]),p=[];function S(e){B(),p.some((o,s)=>o.x==e.srcElement.offsetLeft&&o.y==e.srcElement.offsetTop?(y.value=s,g.value=s,D.value=i.value[s],u.from=s,!0):!1)}const g=t.ref(0);let r,E,x;t.onMounted(()=>{r=document.getElementById("p"),E=r.style.width,x=r.style.height,window.onresize=()=>{r=document.getElementById("p"),E=r.style.width,x=r.style.height}});function B(){r.style.height=r.offsetHeight+"px",r.style.width=r.offsetWidth+"px",p.splice(0);for(let e=i.value.length;e>0;e--){const o=i.value[e-1],s=document.getElementById(n.itemId?o[n.itemId]:o);p.unshift({x:s.offsetLeft,y:s.offsetTop}),s.style.left=s.offsetLeft+"px",s.style.top=s.offsetTop+"px",s.style.position="fixed"}}function w(){i.value.forEach(e=>{const o=document.getElementById(n.itemId?e[n.itemId]:e);o.style.position="static"}),r.style.width=E,r.style.height=x}t.watch(()=>g.value,e=>{y.value!=e&&(w(),i.value.splice(y.value,1),i.value.splice(e,0,D.value),y.value=e,u.to=e,t.nextTick(B))});function W(e){e.preventDefault();for(let o=p.length;o--;o>0){const s=p[o+1],L=p[o];if(e.x>L.x&&e.y>L.y&&(n.direction==="column"?!s||e.y<s.y:!s||e.x<s.x)){g.value=o;break}}}function F(e){e.preventDefault(),w(),f("change",i.value,u)}function V(){console.log("restore"),i.value=[...n.list],setTimeout(()=>{for(let e=i.value.length;e>0;e--){const o=i.value[e-1],s=document.getElementById(n.itemId?o[n.itemId]:o);s.style.left="auto",s.style.top="auto",p.unshift({x:s.offsetLeft,y:s.offsetTop})}},200)}return d({restore:V}),(e,o)=>(t.openBlock(),t.createElementBlock("div",c,[t.createElementVNode("div",{class:t.normalizeClass([n.wrapClass??"","wrapClass"]),draggable:"true",onDragover:W,onDrop:F,style:t.normalizeStyle({"flex-direction":e.$props.direction??"row",display:"flex"})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.value,s=>(t.openBlock(),t.createElementBlock("div",{id:n.itemId?s[n.itemId]:s,key:n.itemId?s[n.itemId]:s,draggable:"true",class:t.normalizeClass(["trp",n.itemClass??""]),onDragstart:S,onDragend:w},[t.renderSlot(e.$slots,"default",{item:s},()=>[t.createTextVNode(t.toDisplayString(s),1)],!0)],42,C))),128))],38)]))}}),j="",_=((h,d)=>{const f=h.__vccOpts||h;for(const[n,i]of d)f[n]=i;return f})(k,[["__scopeId","data-v-fbf2dd46"]]);class v{constructor(d,f){a(this,"ent");a(this,"handle");a(this,"left");a(this,"top");a(this,"dx");a(this,"dy");a(this,"newEle");a(this,"start");a(this,"end");a(this,"over");this.ent=document.getElementById(f),this.handle=document.getElementById(d);const n=this.ent.parentElement;this.ent.style.zIndex="10",this.left=this.ent.offsetLeft,this.top=this.ent.offsetTop,this.ent.style.left=this.left+"px",this.ent.style.top=this.top+"px",this.dx=0,this.dy=0,this.newEle=document.createElement("div"),this.newEle.style.width="100vw",this.newEle.style.height="100vh",this.newEle.style.position="fixed",this.newEle.style.zIndex="1",this.newEle.style.left="0",this.newEle.style.top="0",this.newEle.draggable=!0,this.newEle.style.opacity="0",this.handle.addEventListener("mousedown",()=>{console.log("handle"),this.ent.style.position="fixed",document.getElementsByTagName("body")[0].appendChild(this.newEle),n==null||n.removeChild(this.ent),this.newEle.appendChild(this.ent),this.newEle.addEventListener("dragover",this.over),this.ent.draggable=!0,this.ent.addEventListener("dragstart",this.start),this.ent.addEventListener("dragend",this.end)}),this.start=i=>{this.dx=i.x-this.left,this.dy=i.y-this.top},this.end=i=>{this.left=i.x-this.dx,this.top=i.y-this.dy,this.left>document.body.clientWidth-this.ent.offsetWidth&&(this.left=document.body.clientWidth-this.ent.offsetWidth),this.top>document.body.clientHeight-this.ent.offsetHeight&&(this.top=document.body.clientHeight-this.ent.offsetHeight),this.dx=0,this.dy=0,this.ent.style.left=this.left+"px",this.ent.style.top=this.top+"px",console.log(this.ent.style.top),this.ent.draggable=!1,this.ent.removeEventListener("dragstart",this.start),this.ent.removeEventListener("dragend",this.end);const y=document.getElementsByTagName("body")[0];this.newEle.removeEventListener("dragover",this.over),this.newEle.removeChild(this.ent),y.removeChild(this.newEle),n==null||n.appendChild(this.ent)},this.over=i=>{i.preventDefault(),this.left=i.x-this.dx,this.top=i.y-this.dy,this.ent.style.left=this.left+"px",this.ent.style.top=this.top+"px"}}}const N={name:"DNDEle"},I=t.defineComponent({...N,props:{handlerId:{},left:{},top:{},notFixed:{type:Boolean}},setup(h){const d=h;return t.onMounted(()=>{new v(d.handlerId?d.handlerId:"main","main")}),(f,n)=>(t.openBlock(),t.createElementBlock("div",{id:"main",style:t.normalizeStyle({top:d.top??"auto",left:d.left??"auto",position:d.notFixed?"static":"fixed"})},[t.renderSlot(f.$slots,"default")],4))}});let H=[_,I];const b=h=>{H.map(d=>{h.component(d.name,d)})};let m=window;typeof m<"u"&&m.Vue&&b(m.Vue);const z={install:b};l.DNDEle=I,l.DNDList=_,l.DragWindow=v,l.default=z,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
