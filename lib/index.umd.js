(function(l,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(l=typeof globalThis<"u"?globalThis:l||self,t(l.dndlist={},l.Vue))})(this,function(l,t){"use strict";var $=Object.defineProperty;var M=(l,t,p)=>t in l?$(l,t,{enumerable:!0,configurable:!0,writable:!0,value:p}):l[t]=p;var h=(l,t,p)=>(M(l,typeof t!="symbol"?t+"":t,p),p);const p={id:"p"},C=["id"],T={name:"DNDList"},k=t.defineComponent({...T,props:{wrapClass:{},itemClass:{},direction:{},itemId:{},list:{}},emits:["change"],setup(c,{expose:f,emit:r}){const n=c,i=t.ref([...n.list]);let d=t.ref(0);const m={from:0,to:0},B=t.ref(i.value[0]),y=[];function z(e){L(),y.some((o,s)=>o.x==e.srcElement.offsetLeft&&o.y==e.srcElement.offsetTop?(d.value=s,E.value=s,B.value=i.value[s],m.from=s,!0):!1)}const E=t.ref(0);let a,x,w;t.onMounted(()=>{a=document.getElementById("p"),x=a.style.width,w=a.style.height,window.onresize=()=>{a=document.getElementById("p"),x=a.style.width,w=a.style.height}});function L(){a.style.height=a.offsetHeight+"px",a.style.width=a.offsetWidth+"px",y.splice(0);for(let e=i.value.length;e>0;e--){const o=i.value[e-1],s=document.getElementById(n.itemId?o[n.itemId]:o);y.unshift({x:s.offsetLeft,y:s.offsetTop}),s.style.left=s.offsetLeft+"px",s.style.top=s.offsetTop+"px",s.style.position="fixed"}}function _(){i.value.forEach(e=>{const o=document.getElementById(n.itemId?e[n.itemId]:e);o.style.position="static"}),a.style.width=x,a.style.height=w}t.watch(()=>E.value,e=>{d.value!=e&&(_(),i.value.splice(d.value,1),i.value.splice(e,0,B.value),d.value=e,m.to=e,t.nextTick(L))});function W(e){e.preventDefault();for(let o=y.length;o--;o>0){const s=y[o+1],u=y[o];if(e.x>u.x&&e.y>u.y&&(n.direction==="column"?!s||e.y<s.y:!s||e.x<s.x)){E.value=o;break}}}function F(e){e.preventDefault(),_(),r("change",i.value,m)}function V(){console.log("restore"),i.value=[...n.list],setTimeout(()=>{for(let e=i.value.length;e>0;e--){const o=i.value[e-1],s=document.getElementById(n.itemId?o[n.itemId]:o);s.style.left="auto",s.style.top="auto",y.unshift({x:s.offsetLeft,y:s.offsetTop})}},200)}return f({restore:V}),(e,o)=>(t.openBlock(),t.createElementBlock("div",p,[t.createElementVNode("div",{class:t.normalizeClass([n.wrapClass??"","wrapClass"]),draggable:"true",onDragover:W,onDrop:F,style:t.normalizeStyle({"flex-direction":e.$props.direction??"row",display:"flex"})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.value,(s,u)=>(t.openBlock(),t.createElementBlock("div",{id:n.itemId?s[n.itemId]:s,key:n.itemId?s[n.itemId]:s+String(u),draggable:"true",class:t.normalizeClass(["trp",n.itemClass??""]),onDragstart:z,onDragend:_},[t.renderSlot(e.$slots,"default",{item:s},()=>[t.createTextVNode(t.toDisplayString(s),1)],!0)],42,C))),128))],38)]))}}),j="",v=((c,f)=>{const r=c.__vccOpts||c;for(const[n,i]of f)r[n]=i;return r})(k,[["__scopeId","data-v-e0d2e348"]]);class I{constructor(f,r,n){h(this,"ent");h(this,"handle");h(this,"left");h(this,"top");h(this,"dx");h(this,"dy");h(this,"newEle");h(this,"start");h(this,"end");h(this,"over");this.ent=document.getElementById(r),this.handle=document.getElementById(f);const i=this.ent.parentElement;this.ent.style.zIndex="10",this.left=this.ent.offsetLeft,this.top=this.ent.offsetTop,this.ent.style.left=this.left+"px",this.ent.style.top=this.top+"px",this.dx=0,this.dy=0,this.newEle=document.createElement("div"),this.newEle.style.width="100vw",this.newEle.style.height="100vh",this.newEle.style.position="fixed",this.newEle.style.zIndex="1",this.newEle.style.left="0",this.newEle.style.top="0",this.newEle.draggable=!0,this.newEle.style.opacity="0",this.handle.addEventListener("mousedown",()=>{this.ent.style.position="fixed",document.getElementsByTagName("body")[0].appendChild(this.newEle),i==null||i.removeChild(this.ent),this.newEle.appendChild(this.ent),this.newEle.addEventListener("dragover",this.over),this.ent.draggable=!0,this.ent.addEventListener("dragstart",this.start),this.ent.addEventListener("dragend",this.end),n&&n("drag-start",{x:this.left,y:this.top})}),this.start=d=>{this.dx=d.x-this.left,this.dy=d.y-this.top},this.end=d=>{this.left=d.x-this.dx,this.top=d.y-this.dy,this.left>document.body.clientWidth-this.ent.offsetWidth&&(this.left=document.body.clientWidth-this.ent.offsetWidth),this.top>document.body.clientHeight-this.ent.offsetHeight&&(this.top=document.body.clientHeight-this.ent.offsetHeight),this.dx=0,this.dy=0,this.ent.style.left=this.left+"px",this.ent.style.top=this.top+"px",this.ent.draggable=!1,this.ent.removeEventListener("dragstart",this.start),this.ent.removeEventListener("dragend",this.end);const m=document.getElementsByTagName("body")[0];this.newEle.removeEventListener("dragover",this.over),this.newEle.removeChild(this.ent),m.removeChild(this.newEle),i==null||i.appendChild(this.ent),n&&n("drag-end",{x:this.left,y:this.top})},this.over=d=>{d.preventDefault(),this.left=d.x-this.dx,this.top=d.y-this.dy,this.ent.style.left=this.left+"px",this.ent.style.top=this.top+"px"}}}const N={name:"DNDEle"},D=t.defineComponent({...N,props:{handlerId:{},left:{},top:{},notFixed:{type:Boolean}},emits:["drag-start","drag-end"],setup(c,{emit:f}){const r=c;return t.onMounted(()=>{new I(r.handlerId?r.handlerId:"main","main",f)}),(n,i)=>(t.openBlock(),t.createElementBlock("div",{id:"main",style:t.normalizeStyle({top:r.top??"auto",left:r.left??"auto",position:r.notFixed?"static":"fixed"})},[t.renderSlot(n.$slots,"default")],4))}});let H=[v,D];const b=c=>{H.map(f=>{c.component(f.name,f)})};let g=window;typeof g<"u"&&g.Vue&&b(g.Vue);const S={install:b};l.DNDEle=D,l.DNDList=v,l.DragWindow=I,l.default=S,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
